#!/usr/bin/env bash

set -eu

declare -A chains=(
    [filter]=INPUT:FORWARD:OUTPUT
    [raw]=PREROUTING:OUTPUT
    [mangle]=PREROUTING:INPUT:FORWARD:OUTPUT:POSTROUTING
    [security]=INPUT:FORWARD:OUTPUT
    [nat]=PREROUTING:INPUT:OUTPUT:POSTROUTING
)

for table in "${!chains[@]}"; do
    echo "${chains[$table]}" | tr : $"\n" | while IFS= read -r; do
        iptables -t "$table" -P "$REPLY" ACCEPT
        ip6tables -t "$table" -P "$REPLY" ACCEPT
    done
    iptables -t "$table" -F
    iptables -t "$table" -X
    ip6tables -t "$table" -F
    ip6tables -t "$table" -X
done
